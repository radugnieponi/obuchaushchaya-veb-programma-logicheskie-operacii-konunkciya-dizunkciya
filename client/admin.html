<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Студент</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="student-app">
        <h1>Панель студента</h1>
        <button id="homework">Домашнее задание</button>
        <button id="tests">Тесты</button>
        <button id="logout-button">Выйти</button>

        <div id="content"></div>
    </div>

    <script>
        document.getElementById('logout-button').addEventListener('click', function() {
            fetch('/api/logout')
                .then(() => {
                    window.location.href = '/index.html'; // Перенаправление на страницу входа
                });
        });

        document.getElementById('homework').addEventListener('click', viewAssignments);
        document.getElementById('tests').addEventListener('click', takeTests);

        function viewAssignments() {
            fetch('/api/get-assignments')
                .then(response => response.json())
                .then(assignments => {
                    const list = assignments.map(a => `<li><a href="${a.filePath}">${a.title}</a></li>`).join('');
                    document.getElementById('content').innerHTML = `<ul>${list}</ul>`;
                });
        }

        function takeTests() {
            fetch('/api/get-tests')
                .then(response => response.json())
                .then(tests => {
                    const list = tests.map(test => `
                        <li>${test.Question} 
                        <button onclick="startTest(${test.Id})">Пройти тест</button></li>
                    `).join('');
                    document.getElementById('content').innerHTML = `<ul>${list}</ul>`;
                });
        }

        function startTest(testId) {
            fetch(`/api/start-test/${testId}`)
                .then(response => response.json())
                .then(test => {
                    const form = `<form id="takeTestForm">
                        ${test.Questions.map((q, index) => `
                            <div>
                                <label>${q.QuestionText}</label><br>
                                ${q.Answers.split(',').map((ans, aIndex) => `
                                    <input type="checkbox" name="question${index}" value="${aIndex}"> ${ans}<br>
                                `).join('')}
                            </div>
                        `).join('')}
                        <button type="submit">Отправить тест</button>
                    </form>`;

                    document.getElementById('content').innerHTML = form;

                    document.getElementById('takeTestForm').addEventListener('submit', function (event) {
                        event.preventDefault();
                        const results = Array.from(new FormData(event.target)).reduce((acc, [key, value]) => ({
                            ...acc,
                            [key]: value
                        }), {});
                        fetch(`/api/submit-test/${testId}`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(results),
                        }).then(response => response.json())
                          .then(result => alert(result.message));
                    });
                });
        }
    </script>
</body>
</html>